---
title: "coups"
author: "Nidal"
date: "4/1/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      warning = FALSE,
                      message = FALSE)

library(tidyverse)
library(gifski)
library(janitor)
library(gganimate)
library(readxl)
library(infer)

coups <- read_excel("raw-data/Coupdata.xls") %>% 
  clean_names()

polity <- read_excel("raw-data/polity_iv.xls") %>% 
  clean_names()
```

```{r clean_and_join}

clean_coups <- coups %>% 
  select(year_of_event, cow_code, country_where_action_occurred, type_of_coup, 
         realized_coup, unrealized)

clean_polity <- polity %>% 
  select(year, ccode, country, scode, polity) %>% 
  filter(year >= "1946") %>% 
  filter(polity != "-88") %>% 
  filter(polity != "-77") %>% 
  filter(polity != "-66")

join_copo <- clean_coups %>% 
  inner_join(clean_polity, by = c("year_of_event" = "year", 
                                  "country_where_action_occurred" = "country"))
```

```{r sample}

set.seed(2)

coup_data <- join_copo %>%
  rep_sample_n(size = nrow(join_copo), reps = 50, replace = TRUE) %>% 
  group_by(polity, realized_coup, type_of_coup, replicate) %>% 
  count(type_of_coup) %>% 
  mutate(number = n)

write.csv(coup_data, "Coups/coup_data.csv")
```

```{r plot}

simple_graph <- ggplot(coup_data, 
                       aes(x = polity, y = number, color = type_of_coup)) + 
  geom_jitter(width = 0.5, height = 0.5) +
  labs(
    title = "Number of Coups d'Etat by Regime Type",
    subtitle = "Including attempts and conspiracies",
    x = "Polity IV scale (-10 is least democratic, +10 is most democratic)",
    y = "Number of Coups d'Etat",
    color = "Type of Coup",
    caption = "Data from the Polity IV Project and the Coup d'Etat Project") +
  theme_classic()

simple_graph + facet_wrap(~type_of_coup)

attempts <- coup_data %>% 
  filter(type_of_coup == "attempt") %>% 
  ggplot(aes(polity, y = number, color = type_of_coup)) + 
  geom_jitter(width = 0.5, height = 0.5)
ggsave("attempt.png", path = "Coups")

consp <- coup_data %>% 
  filter(type_of_coup == "conspiracy") %>% 
  ggplot(aes(polity, y = number, color = type_of_coup)) + 
  geom_jitter(width = 0.5, height = 0.5)
ggsave("consp.png", path = "Coups")

coup <- coup_data %>% 
  filter(type_of_coup == "coup") %>% 
  ggplot(aes(polity, y = number, color = type_of_coup)) + 
  geom_jitter(width = 0.5, height = 0.5)
ggsave("coup.png", path = "Coups")
```


```{r graph_fun}

simple_graph +
  transition_manual(type_of_coup)

anim_save("coups1.gif", path = "Coups")

```


